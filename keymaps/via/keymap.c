#include QMK_KEYBOARD_H

// Komentář: Definice časového limitu (2 sekundy = 2000 ms)
#define CYCLE_LAYER_TIMEOUT 2000

// Komentář: Globální stavové proměnné
int cycle_layer = 1; // 0 = standardní režim, 1 = režim cyklování vrstev (okno je otevřené)
uint16_t cycle_layer_timer = 0; 

// Komentář: Pomocná proměnná pro zjištění, zda došlo k otočení/změně vrstvy v rámci okna
bool layer_was_cycled = false; 

// Komentář: Proměnná pro uložení poslední vrstvy před přechodem na speciální vrstvu
uint8_t previous_base_layer = 0; 

// Komentář: Rozsah vrstev k cyklování (0, 1, 2)
#define LAYER_CYCLE_START 0 
#define LAYER_CYCLE_COUNT 4 
#define LAYER_CYCLE_END   (LAYER_CYCLE_START + LAYER_CYCLE_COUNT) 

// Komentář: Vlastní klávesový kód pro stisk enkodéru, který MUSÍ být v keymapě
enum key_codes {
    KC_LAYER_MODE = QK_USER,
    // KC_L_PLUS, KC_L_MINUS - tyto už nepotřebujeme
};


// Komentář: Funkce pro zpracování stisku/uvolnění klávesy. Řídí aktivaci okna.
// Komentář: Funkce pro zpracování stisku/uvolnění klávesy. Řídí aktivaci okna.
bool process_record_user(uint16_t keycode, keyrecord_t *record) {

    switch (keycode) {
        case KC_LAYER_MODE: 
            if (record->event.pressed) {
                // Komentář: Při stisku vždy resetujeme časovač (udrží nebo otevře okno)
                cycle_layer_timer = timer_read(); 
                
                // Komentář: Pokud je okno zavřené, otevřeme ho
                if (cycle_layer == 0) {
                    cycle_layer = 1; 
                    layer_was_cycled = false; // Resetujeme příznak pro detekci "normální funkce"
                }
                
                // Komentář: TUTO KLÁVESU ZPRACOVÁVÁME SAMI, BLOKUJEME QMK
                return false; 
            } else { // key released
                // Komentář: Tuto klávesu BLOKUJEME i při uvolnění
                return false;
            }
            break;
    }
    // Komentář: PRO VŠECHNY OSTATNÍ KLÁVESY (KC_A, KC_ENT atd.) vracíme TRUE.
    // Tím zajistíme, že QMK je normálně zpracuje.
    return true; 
}

// Komentář: Funkce spouštěná QMK neustále. Kontroluje časový limit okna.
void matrix_scan_user(void) {
    
    // Komentář: Kontrola, zda je cyklovací režim aktivní
    if (cycle_layer == 1) { 
        
        // Komentář: Kontroluje, zda uplynulo více než 2000 ms od poslední interakce (stisk/otočení)
        if (timer_elapsed(cycle_layer_timer) > CYCLE_LAYER_TIMEOUT) {
            
            // Komentář: Čas vypršel, zavři okno/opusť režim
            cycle_layer = 0; 
            
            // Komentář: Zde provedeme "normální funkci" stisku, pokud nedošlo k otočení enkodéru
            if (layer_was_cycled == false) {
                // Komentář: PŘÍKLAD NORMÁLNÍ FUNKCE (zde jako Enter)
                tap_code(KC_ENT); 
            }
        }
    }
}


// Komentář: Funkce volaná při otáčení enkodéru.
// ... [Globální proměnné a ostatní funkce] ...

// Komentář: Funkce volaná při otáčení enkodéru.
bool encoder_update_user(uint8_t index, bool clockwise) {
    
    if (index == 0) { 
        
        // Komentář: REŽIM 1: Cyklování vrstev (aktivní po stisku)
        if (cycle_layer == 1) {
            
            cycle_layer_timer = timer_read(); // Komentář: Reset časovače (prodlouží okno)
            layer_was_cycled = true;          // Komentář: Nastavíme příznak, že došlo k rotaci
            
            // Logika pro cyklickou ZMĚNU VRSTEV (s obrácenou logikou otáčení)
            uint8_t current_layer = get_highest_layer(layer_state); 
            uint8_t next_layer = current_layer;

            if (current_layer >= LAYER_CYCLE_COUNT) { 
                next_layer = previous_base_layer; 
            }

            if (clockwise) {
                // Otáčení DOPRAVA -> SNÍŽENÍ vrstvy (2 -> 1 -> 0 -> 2)
                if (next_layer == LAYER_CYCLE_START) { 
                    next_layer = LAYER_CYCLE_END - 1; 
                } else {
                    next_layer--; 
                }
            } else {
                // Otáčení DOLEVA -> ZVÝŠENÍ vrstvy (0 -> 1 -> 2 -> 0)
                next_layer++;
                if (next_layer >= LAYER_CYCLE_END) { 
                    next_layer = LAYER_CYCLE_START; 
                }
            }
            
            previous_base_layer = next_layer;
            layer_move(next_layer);
            
            // Komentář: Událost zpracována, nepokračovat ve výchozím chování
            return true; 
        } 
        
        // ----------------------------------------------------------------------
        // Komentář: REŽIM 0: NORMÁLNÍ FUNKCE (okno je zavřené)
        // ----------------------------------------------------------------------

        if (clockwise) {
            // Komentář: Otáčení doprava -> Zvýšit hlasitost
            tap_code(KC_VOLU);
        } else {
            // Komentář: Otáčení doleva -> Snížit hlasitost
            tap_code(KC_VOLD);
        }
        
        // Komentář: Událost zpracována, nepokračovat ve výchozím chování
        return true; 
    }
    
    // Komentář: V případě, že to není index 0, necháme QMK, ať to zpracuje dál
    return false; 
}



const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = { // definice vrstev

// Definice vrstev pro keymap.c s KAZDOU klávesou nastavenou na KC_NO.

// Definice vrstev pro keymap.c pro 4x4 makropad.
// Všechny klávesy jsou nastaveny na KC_NO (No Operation).

[0] = LAYOUT_martin_4x4( // základní vrstva
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 0
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 1
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 2
    KC_NO, KC_NO, KC_NO, KC_NO, KC_A // Row 3
),

        

[1] = LAYOUT_martin_4x4( // druhá vrstva
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 0
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 1
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 2
    KC_NO, KC_NO, KC_NO, KC_NO, KC_A  // Row 3
),

     


[2] = LAYOUT_martin_4x4( // třetí vrstva
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 0
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 1
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 2
    KC_NO, KC_NO, KC_NO, KC_NO, KC_A  // Row 3
),

       

[3] = LAYOUT_martin_4x4( // settings vrstva
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 0
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 1
    KC_NO, KC_NO, KC_NO, KC_NO, // Row 2
    KC_NO, KC_NO, KC_NO, KC_NO, KC_A // Row 3
)



        
};


#ifdef OLED_ENABLE

bool oled_task_user(void) { 
    // definice obázku pro OLED
    // Tyto definice musí být uvnitř funkce, pokud jsou definovány jako 'static' v rámci souboru,
    // ale často se dávají mimo jakoukoliv funkci (globálně) nebo se používá 'extern'.
    // Pro jednoduchost a aby se vyřešily chyby s nepoužitými proměnnými, 
    // necháme je zde, ale budou se opakovaně definovat.

    static const char image11 [] PROGMEM = { // vrstva 1 design 1
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe0, 0xe0, 0x00, 0x00, 0x10, 
0x30, 0x38, 0x38, 0x38, 0x38, 0x38, 0x30, 0x00, 0x00, 0x00, 0x00, 0x10, 0x30, 0x38, 0x38, 0x38, 
0x38, 0x38, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0xc0, 0x80, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xf0, 0xf0, 0xf0, 0xf8, 0xf8, 
0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 
0xf8, 0xf8, 0xf0, 0xf0, 0xf0, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x0f, 0x07, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xe0, 0xe0, 0xe0, 0x00, 0x80, 0xc0, 0x80, 0x80, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xfc, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x1f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xe0, 0xe0, 0xc0, 
0xc0, 0x80, 0x80, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0x0f, 0x0f, 0x0f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x0f, 0x0f, 0x0f, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0xff, 0x7e, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x03, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x07, 0x03, 0x07, 0x07, 0x0f, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xe0, 0xe1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0xfc, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x03, 
0x03, 0x07, 0x07, 0x07, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xf8, 0xf0, 0xf0, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x0c, 0x0c, 0x0c, 
0x0c, 0x0c, 0x0c, 0x04, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x04, 
0x00, 0x00, 0x00, 0x06, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x0f, 0x0f, 0x0f, 0x0f, 
0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 
0x0f, 0x0f, 0x0f, 0x0f, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    }; // <- ZDE JSI MĚL ZAVŘENOU ZÁVORKU '}' FUNKCE, MÍSTO TOHO MÁ BÝT POUZE STŘEDNÍK ';' PRO KONEC POLE!


    static const char image21 [] PROGMEM = { // vrstva 2 design 1
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xc0, 0x00, 0x00, 0x20, 
0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x20, 0x30, 0x30, 0x30, 0x30, 
0x30, 0x30, 0x70, 0x70, 0x60, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x80, 0xe0, 0xe0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xe0, 0xc0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xc0, 0x00, 0x00, 0x00, 0x20, 
0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x20, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x30, 0x30, 0x30, 
0x30, 0x30, 0x70, 0x60, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x1f, 0x0f, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xc0, 0xc0, 0xc0, 0x00, 0x00, 0x80, 0x00, 0x00, 0xc0, 0xc0, 0xc0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xfc, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x1f, 0x3f, 0x3f, 0x7f, 
0x7f, 0xff, 0xff, 0x3f, 0x3f, 0x3f, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xc0, 0xe0, 0xe0, 0x80, 0x80, 0x80, 0x80, 0x80, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xfc, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0xfe, 0x7c, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x07, 0x0f, 0x1f, 0x1e, 0x1f, 0x1f, 0x0f, 0x07, 0x0f, 0x0f, 0x1f, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xc1, 0xc1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xf0, 0xf0, 0xf8, 
0xf8, 0xf0, 0xf0, 0xf0, 0xf0, 0xf8, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xfe, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x0f, 0x1f, 0x1f, 0x07, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xe1, 0xc1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x0c, 0x1c, 0x1c, 
0x1c, 0x1c, 0x1c, 0x08, 0x00, 0x00, 0x00, 0x00, 0x08, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x08, 
0x00, 0x00, 0x00, 0x0e, 0x0f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x03, 0x0f, 0x0f, 0x0f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 
0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x0f, 0x0f, 0x0f, 0x03, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x0c, 0x1c, 0x1c, 
0x1c, 0x1c, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x08, 0x00, 
0x00, 0x00, 0x00, 0x0f, 0x0f, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    };

    static const char image31 [] PROGMEM = { // vrstva 3 design 1
 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xf0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x80, 0xe0, 0xc0, 0x00, 0x00, 0x00, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x00, 
0x00, 0x00, 0x00, 0x10, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x70, 0x20, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xe0, 0x00, 0x00, 0x00, 0x30, 
0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x10, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x30, 0x30, 0x30, 
0x30, 0x30, 0x30, 0x70, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0x1f, 0x1f, 0x1f, 0xff, 0x7f, 0x3f, 0x7f, 0x7f, 0x1f, 0x1f, 0x1f, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xe0, 0xe0, 0xc0, 
0xc0, 0x80, 0x80, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0xfc, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0xe0, 0xf0, 0xf0, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 0xf0, 0xf0, 0xf0, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xfc, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xfc, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf8, 0xfc, 0xf8, 0xf8, 0xf0, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x7e, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x03, 
0x03, 0x07, 0x07, 0x07, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe1, 0xc1, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xfe, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x07, 0x0f, 0x0f, 0x03, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0xe1, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x0f, 0x0f, 0x0f, 0x0f, 
0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 
0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x04, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x03, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x0c, 0x0c, 0x0c, 
0x0c, 0x0c, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x0c, 0x00, 
0x00, 0x00, 0x00, 0x0f, 0x07, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    };

    static const char image41 [] PROGMEM = { // vrstva 4 design 1
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe0, 0xe0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xf0, 0xe0, 0xe0, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0x0f, 0x0f, 0x0f, 0x1f, 0x0f, 0x0f, 0x0f, 0x0f, 0x1f, 0xff, 0xff, 0xff, 0x0f, 0x07, 
0x03, 0x83, 0x83, 0x83, 0x07, 0x07, 0x1f, 0xff, 0xff, 0xff, 0x87, 0x87, 0x07, 0x07, 0x07, 0x07, 
0x07, 0x07, 0x87, 0xff, 0xff, 0xff, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x7f, 0xff, 
0xff, 0x7f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x1f, 0x0f, 0x1f, 0xff, 0xff, 0x7f, 0x3f, 0x3f, 
0x3f, 0x3f, 0x3f, 0x1f, 0x1f, 0x0f, 0x1f, 0xff, 0xff, 0x1f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 
0x0f, 0x0f, 0xff, 0xff, 0xff, 0x0f, 0x0f, 0x0f, 0x1f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
0xff, 0xff, 0xf0, 0xe0, 0xe0, 0xe0, 0xe0, 0xf0, 0xe0, 0xe0, 0xe0, 0xff, 0xff, 0xff, 0xf0, 0xc0, 
0xc0, 0x80, 0x80, 0xc1, 0xc0, 0xe0, 0xf0, 0xff, 0xff, 0xff, 0xc1, 0xc0, 0xc0, 0xc0, 0xc0, 0xc0, 
0xc2, 0xc3, 0xc3, 0xff, 0xff, 0xff, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xfc, 0xff, 
0xff, 0xfc, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf8, 0xf0, 0xf0, 0xf0, 0xff, 0xff, 0xfc, 0xf8, 0xf8, 
0xf8, 0xf8, 0xf8, 0xf0, 0xf0, 0xf0, 0xf0, 0xff, 0xff, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 
0xf0, 0xf0, 0xff, 0xff, 0xff, 0xf0, 0xe0, 0xe0, 0xe0, 0xe0, 0xf0, 0xe0, 0xe0, 0xe0, 0xff, 0xff, 
0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0f, 0x0f, 0x1f, 0x1f, 0x1f, 
0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 
0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 
0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 
0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 
0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 
0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 
0x1f, 0x1f, 0x1f, 0x0f, 0x0f, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    }; // <- CHYBA: Zde bylo tvé předčasné uzavření funkce, přičemž měl být jen středník


   switch (get_highest_layer(layer_state)) { 



        case 0:
            // Komentář: Vykreslení obrázku pro vrstvu 1
            oled_write_raw_P(image11, sizeof(image11));
            break;

        case 1:
            // Komentář: Vykreslení obrázku pro vrstvu 2
            oled_write_raw_P(image21, sizeof(image21));
            break;

        case 2:
            // Komentář: Vykreslení obrázku pro vrstvu 3
            oled_write_raw_P(image31, sizeof(image31));
            break;

        case 3:
            // Komentář: Vykreslení obrázku pro vrstvu 4 (LS)
            oled_write_raw_P(image41, sizeof(image41));
            break;

        default:
             // Komentář: Chybová zpráva, pokud není aktivní žádná z definovaných vrstev
             oled_write("Layer error", false);
             break; 
    }

    // Komentář: Funkce musí vrátit logickou hodnotu (bool)

    // Řádek 298 je zdeif (cycle_layer == 1) { 


 return false;

#endif // OLED_ENABLE

} 



